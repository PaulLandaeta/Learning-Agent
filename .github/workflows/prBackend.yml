name: Pull-Request-Verification-client-BACKEND

on:
  pull_request:
    branches:
      - qa
      - develop
    paths:
      - 'backend/**'

jobs:

  Build-Verification:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20.18'

      - name: Install dependencies and build
        run: |
            npm install
            npm run build

  PR-Notification:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      
      
      - name: Set branch name
        id: branch-name
        run: |
            echo "BRANCH_NAME=$(echo ${{ github.head_ref }} | sed 's/refs\/heads\///')" >> $GITHUB_ENV
            echo "BRANCH_NAME_DEST=$(echo ${{ github.event.pull_request.base.ref }} | sed 's/refs\/heads\///')" >> $GITHUB_ENV

      - name: Discord Webhook Action for PR
        uses: tsickert/discord-webhook@v5.3.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK_BACKEND }}
          embed-title: "ğŸš€ Nuevo Pull Request ğŸš€"
          embed-color: "16711680"
          embed-description: |                                                    
                    ğŸ“œ **Repositorio:** ${{ github.event.repository.name }}
        
                    ğŸ“ **PR ID:** #${{ github.event.number }}
        
                    ğŸ“¢ **TÃ­tulo del PR:** ${{ github.event.pull_request.title }}
        
                    ğŸ”— **URL del PR:** ${{ github.event.pull_request.html_url }}
        
                    ğŸ”€ **Branch origin:** ${{ env.BRANCH_NAME }}

                    ğŸ”€ **Branch destiny:** ${{ env.BRANCH_NAME_DEST }}
        
                    ğŸ” **Cambios:** [Ver Cambios](${{ github.event.pull_request._links.html.href }})
                    
                    **Â¡Revisa la secciÃ³n de Pull Requests del repositorio!** 
          embed-author-name: "${{ github.event.pull_request.user.login }}"
          embed-author-url: "${{ github.event.pull_request.user.html_url }}"
          embed-author-icon-url: "${{ github.event.pull_request.user.avatar_url }}"